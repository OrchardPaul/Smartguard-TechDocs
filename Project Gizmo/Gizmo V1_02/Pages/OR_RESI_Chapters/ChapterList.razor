@page "/chapterlist"

@inject IJSRuntime jsRuntime



<h1>Chapters</h1>

@if (selectedChapter == "")
{
    <h4 class="modal-title">Case Type Groups</h4>
    <div class="container-fluid">
        <div class="row">
            @if (lstAllObjects is null)
            {
                <div class="spinner"></div>
            }
            else
            {
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2">
                    @foreach (var caseTypeGroup in lstAllObjects.Where(C => C.ParentId == 0)
                                                   .Where(C => !(C.CaseTypeGroup is null))
                                                   .Select(C => C.CaseTypeGroup)
                                                   .Distinct()
                                                   .ToList())
                    {
                        <a class="shadow card rounded caseType_@caseTypeGroup" @onclick="() => SelectCaseTypeGroup(caseTypeGroup)">@caseTypeGroup</a>
                        <input type="button" data-toggle="modal" @onclick='() => PrepareCaseTypeForEdit(caseTypeGroup,"CaseTypeGroup")' data-target="#chapterCaseTypeEdit" class="btn btn-primary" value="Edit" />
                        @if (caseTypeGroup == selectedCaseTypeGroup)
                        {
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2">
                    @foreach (var caseType in lstAllObjects.Where(C => C.ParentId == 0)
                                                  .Where(C => !(C.CaseType is null))
                                                  .Where(C => C.CaseTypeGroup == selectedCaseTypeGroup)
                                                  .Select(C => C.CaseType)
                                                  .Distinct()
                                                  .ToList())
                    {
                        <a class="shadow card rounded caseType_@caseType" @onclick="() => SelectCaseType(caseType)">@caseType</a>
                        <input type="button" data-toggle="modal" @onclick='() => PrepareCaseTypeForEdit(caseType,"CaseType")' data-target="#chapterCaseTypeEdit" class="btn btn-primary" value="Edit" />
                        @if (caseType == selectedCaseType)
                        {
                            @foreach (var Chapter in lstAllObjects.Where(C => C.CaseType == selectedCaseType).Where(C => C.Type == "Chapter").ToList())
                            {
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2">
                                    <a class="shadow card rounded chapterCard_@Chapter.Name" @onclick="() => SelectDocList(Chapter.Name,Chapter.Id)">@Chapter.Name</a>
                                    <input type="button" data-toggle="modal" @onclick='() => PrepareChapterForEdit(Chapter)' data-target="#chapterAddOrEditModel" class="btn btn-primary" value="Edit" />
                                </div>
                            }
                        }
                    }
                </div>
                        }
                    }
                </div>
            }
        </div>
        <input type="button" data-toggle="modal" @onclick="PrepareChapterForInsert" data-target="#chapterAddOrEditModel" class="btn btn-primary" value="Add Chapter" />
    </div>
}


@if (selectedChapter != "")
{
    <input type="button" @onclick="SelectHome"  class="btn btn-primary" value="Back" />

    <h4 class="modal-title">Chapters Items</h4>
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2">
        @if (displaySection == "Agenda")
        {
            <span class="shadow card rounded chapterItem_Agenda" @onclick='() => ShowAgenda("Hide", "Agenda")'>Agendas (@lstAgendas.Count) </span>
        }
        else
        {
            <span class="shadow card rounded chapterItem_Agenda" @onclick='() => ShowAgenda("Show", "Agenda")'>Agendas (@lstAgendas.Count)</span>
        }
    </div>

    @if (displaySection == "Agenda")
    {
        <div class="fade-in">
            @foreach (var Agenda in lstAgendas)
            {
                <div class="OR_ChapterItemTable">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2 ">
                        <span class="shadow card subCard rounded chapterItem_Agenda">@Agenda.Name</span>
                    </div>
                </div>
            }
        </div>
    }


    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2">
        @if (displaySection == "Fee")
        {
            <span class="shadow card rounded chapterItem_Fee" @onclick='() => ShowAgenda("Hide", "Fee")'>Fees (@lstFees.Count)</span>
        }
        else
        {
            <span class="shadow card rounded chapterItem_Fee" @onclick='() => ShowAgenda("Show", "Fee")'>Fees (@lstFees.Count)</span>
        }
    </div>

    @if (displaySection == "Fee")
    {
        <div class="fade-in">
            @foreach (var Fee in lstFees)
            {
                <div class="OR_ChapterItemTable">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2 ">
                        <span class="shadow card subCard rounded chapterItem_Fee" @onclick='(() => PrepareForEdit(Fee,"Fee"))' data-toggle="modal" data-target="#taskModal" value="Edit">@Fee.Name</span>
                    </div>
                </div>
            }

            <input type="button" data-toggle="modal" data-target="#taskModal" class="btn btn-primary" value="Add Fee" />
        </div>
    }

    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2">
        @if (displaySection == "Docs")
        {
            <span class="shadow card rounded chapterItem_Documents" @onclick='() => ShowAgenda("Hide", "Docs")'>Documents / Steps (@lstDocs.Count)</span>
        }
        else
        {
            <span class="shadow card rounded chapterItem_Documents" @onclick='() => ShowAgenda("Show", "Docs")'>Documents / Steps (@lstDocs.Count)</span>
        }
    </div>

    @if (displaySection == "Docs")
    {
        <ul ondragover="event.preventDefault();" class="fade-in">
            @foreach (var docs in lstDocs)
            {
                <li draggable="true" style="list-style-type:none;" @key="docs.Id" tabindex="1">
                    <div class="OR_ChapterItemTable">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2 ">
                            <span class="shadow card subCard rounded chapterItem_Documents"
                                  @onclick='(() => PrepareForEdit(docs,"Document / Step"))'
                                  data-toggle="modal"
                                  data-target="#taskModal"
                                  value="Edit">
                                <i class="fas fa-sort"></i> @docs.Name

                            </span>
                        </div>
                    </div>
                </li>
            }

        </ul>
        <input type="button" class="btn btn-primary" @onclick='(() => PrepareForInsert("Document / Step"))' data-toggle="modal" data-target="#taskModal" value="Add Letter" />
    }

    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2">
        @if (displaySection == "Status")
        {
            <span class="shadow card rounded chapterItem_Status" @onclick='() => ShowAgenda("Hide", "Status")'>Status (@lstStatus.Count)</span>
        }
        else
        {
            <span class="shadow card rounded chapterItem_Status" @onclick='() => ShowAgenda("Show", "Status")'>Status (@lstStatus.Count)</span>
        }
    </div>

    @if (displaySection == "Status")
    {
        <div class="fade-in">
            @foreach (var status in statusObjects)
            {
                <div class="OR_ChapterItemTable">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 p-2 ">
                        <span class="shadow card subCard rounded chapterItem_Status" @onmouseout="() => ToggleStatusHover(status)" @onmouseover="() => ToggleStatusHover(status)" @onclick='(() => PrepareForEdit(status.management,"Status"))' data-toggle="modal" data-target="#taskModal" value="Edit">@status.management.Name</span>
                        @if (status.hoveredOver)
                        {
                            <div>Hover</div>
                        }
                    </div>
                </div>
            }

            <input type="button" data-toggle="modal" data-target="#taskModal" class="btn btn-primary" value="Add Letter" />
        </div>
    }


}

<ChapterDetail TaskObject=editObject DataChanged="@DataChanged" selectedCaseType="@selectedCaseType" selectedList="@selectedList" dropDownDocumentList="@dropDownDocumentList">
    <CustomHeader>@customHeader</CustomHeader>
</ChapterDetail>

<ChapterAddOrEdit TaskObject="editChapterObject" DataChanged="DataChanged" AllObjects="lstAllObjects"></ChapterAddOrEdit>

<ChapterCaseTypeEdit TaskObject="@editCaseType" isCaseTypeOrGroup="@isCaseTypeOrGroup" DataChanged="DataChanged" originalName="@editCaseType" caseTypeGroupName="@selectedCaseTypeGroup"></ChapterCaseTypeEdit>