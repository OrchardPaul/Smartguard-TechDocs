@using Gizmo_V1_02.Data.CustomFormObjects

<EditForm Model="@TaskObject" OnValidSubmit="@HandleValidSubmit">
    <div class="modal-body">

        <DataAnnotationsValidator />
        <div class="form-group">
            <label>Case Type Group</label>
            <div class="form-label-check">
                <label>New</label><input type="checkbox" @bind-value="addNewCaseTypeGroupOption" />
            </div>
            @if (!addNewCaseTypeGroupOption)
            {

                @if (AllChapters is null)
                {
                    <div class="spinner"></div>
                }
                else
                {
                    <InputSelect class="form-control" ValueExpression="@(() => TaskObject.CaseTypeGroup)"
                                 Value="@TaskObject.CaseTypeGroup"
                                 ValueChanged="@((string value) => SelectExistingCaseTypeGroup(value))">
                        @foreach (var c in AllChapters
                                      .Where(C => !(C.SmartflowObject.CaseTypeGroup is null))
                                      .OrderBy(C => C.SmartflowObject.CaseTypeGroup)
                                      .Select(C => C.SmartflowObject.CaseTypeGroup)
                                      .Distinct()
                                      .ToList())
                        {
                            <option value="@c">
                                @c
                            </option>
                        }
                    </InputSelect>
                }
            }
            else
            {

                <InputText class="form-control" @bind-Value="TaskObject.CaseTypeGroup"></InputText>
            }


        </div>

        <div class="form-group">
            <label>Case Type</label>
            <div class="form-label-check">
                <label>New</label>
                <input type="checkbox" @bind-value="addNewCaseTypeOption" />
            </div>
            @if (!addNewCaseTypeOption)
            {
                @if (AllChapters is null)
                {
                    <div class="spinner"></div>
                }
                else
                {
                    <InputSelect class="form-control" ValueExpression="@(() => TaskObject.CaseType)"
                                 Value="@TaskObject.CaseType"
                                 ValueChanged="@((string value) => SelectExistingCaseType(value))">
                        @foreach (var c in AllChapters
                                     .Where(C => C.SmartflowObject.CaseTypeGroup == TaskObject.CaseTypeGroup)
                                     .Where(C => !(C.SmartflowObject.CaseType is null))
                                     .OrderBy(C => C.SmartflowObject.CaseType)
                                     .Select(C => C.SmartflowObject.CaseType)
                                     .Distinct()
                                     .ToList())
                        {
                            <option value="@c">
                                @c
                            </option>
                        }
                    </InputSelect>
                }

            }
            else
            {
                <InputText class="form-control" @bind-Value="TaskObject.CaseType"></InputText>
            }


        </div>

        <div class="form-group">
            <label>Chapter Name</label>
            <div class="form-label-check">
                <label>New</label>
                <input type="checkbox" @onchange="() => ResetChapter()" />
            </div>
            @if (!AddNewChapterOption)
            {
                @if (AllChapters is null)
                {
                    <div class="spinner"></div>
                }
                else
                {
                    <InputSelectInteger class="form-control" ValueExpression="@(() => TaskObject.Id)"
                                        Value="@TaskObject.Id"
                                        ValueChanged="@((int value) => SelectExistingChapter(value))"
                                        id="Summary">
                        @foreach (var c in AllChapters
                                                  .Where(C => C.SmartflowObject.CaseTypeGroup == TaskObject.CaseTypeGroup)
                                                  .Where(C => C.SmartflowObject.CaseType == TaskObject.CaseType)
                                                  .OrderBy(C => C.SmartflowObject.SeqNo)
                                                  .ToList())
                        {
                            <option value="@c.SmartflowObject.Id">
                                @c.SmartflowObject.SmartflowName
                            </option>
                        }
                    </InputSelectInteger>
                }
            }
            else
            {
                <InputText class="form-control" @bind-Value="TaskObject.SmartflowName"></InputText>
            }
            <ValidationMessage For="@(() => TaskObject.SmartflowName)" />
        </div>

        <div class="form-group">
            <label class="font-weight-bold">Copy Options</label>
            @foreach (var option in CopyOptions)
            {
                <div class="ml-2 mr-1">
                    <label>@option.Option</label>
                    <input class="float-right" type="checkbox" @bind-value="option.Selected" />
                </div>
            }
        </div>

    </div>
    <div class="button-container">
        <button type="submit" class="btn btn-main">Save</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" @onclick="Close">Cancel</button>
    </div>

</EditForm>