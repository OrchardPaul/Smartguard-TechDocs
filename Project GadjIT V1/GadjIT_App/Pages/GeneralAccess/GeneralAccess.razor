@page "/GeneralAccess"
@using System.Globalization

@inject IJSRuntime jsRuntime

@attribute [Authorize(Roles ="Super User")]

<div class="tran-block page-header-block ">
    <div class="form-group" style="margin: 10px 10px 10px 20px">
        <label class="font-weight-bold">Query: </label>
        <div style="margin: 5px 0 5px 0;">
            <textarea type="text" rows="10" style="width: 600px; height: 100px;" class="form-control" @bind="Query" />
        </div>
        <div style="margin: 5px 0 5px 0;">
            <input type="text" @bind-value="EntityRef">
            <input style="width: 40px;" type="number" @bind-value="MatterNo">

            <button style="height: 25px; width: 40px;" class="btn btn-secondary" @onclick="AddEntityRefMatterNo"><i class="fas fa-plus"></i></button>
        </div>

        <button class="btn btn-main" @onclick="RunQuery">Execute</button>
    </div>    
    
</div>

<div class="tran-block rounded" style="width: calc(100% - 40px)" >
    
    <div class="grid-admin grid-admin-query"  >
        
        <table id="QueryResults" class="display" >
            <thead>
                <tr>
                    @if(QueryResults.Count() > 0)
                    {
                        @foreach (var i in QueryResults.FirstOrDefault())
                        {
                            <th  style="text-overflow: ellipsis;" class="sorting sorting_asc">@i.Key</th>
                        }
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var i in QueryResults)
                {
                    <tr >
                    @foreach(var c in i.Values)
                    {
                        <td  style="text-overflow: ellipsis;">
                        @if(!(c is null))
                        {
                            @if(@DateTime.TryParse(c.ToString(), out TryDate))
                            {
                                @string.Format("{0:dd MMM yyyy}",DateTime.Parse(c.ToString()))
                            }
                            else
                            {
                                @c.ToString()
                            }

                        }
                        </td>
                        
                    }
                    </tr>

                }
            </tbody>
        </table>
    </div>




</div>

